{% extends 'base.html' %}

{% block title %}{{ course.title }} - Kelajak Dasturchilari{% endblock %}

{% block content %}

<section class="min-h-screen px-4 py-20">
    <div class="container mx-auto">
        
        <!-- Back Button -->
        <div class="mb-6" data-aos="fade-right">
            <a href="{% url 'course_list' %}" class="btn btn-ghost text-white">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                –û—Ä—Ç–≥–∞
            </a>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Course Header -->
                <div class="glass rounded-2xl p-8" data-aos="fade-up">
                    <!-- Badges -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <div class="badge badge-lg glass">
                            {% if course.level == 'beginner' %}
                                üü¢ –ë–æ—à–ª–∞–Ω—É–≤—á–∏
                            {% elif course.level == 'intermediate' %}
                                üü° –é—Ä—Ç–∞
                            {% else %}
                                üî¥ –ò–ª“ì–æ—Ä
                            {% endif %}
                        </div>
                        <div class="badge badge-lg glass">
                            <i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                            {{ course.duration_hours }} —Å–æ–∞—Ç
                        </div>
                        <div class="badge badge-lg glass">
                            <i data-lucide="users" class="w-4 h-4 mr-1"></i>
                            {{ course.students_count }} —Å—Ç—É–¥–µ–Ω—Ç
                        </div>
                        {% if course.is_free %}
                            <div class="badge badge-lg badge-success">–ë–µ–ø—É–ª</div>
                        {% endif %}
                    </div>
                    
                    <!-- Title -->
                    <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">{{ course.title }}</h1>
                    
                    <!-- Description -->
                    <p class="text-gray-300 text-lg mb-6">{{ course.description }}</p>
                    
                    <!-- Rating -->
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2">
                            <div class="flex text-yellow-400">
                                <i data-lucide="star" class="w-5 h-5 fill-current"></i>
                                <i data-lucide="star" class="w-5 h-5 fill-current"></i>
                                <i data-lucide="star" class="w-5 h-5 fill-current"></i>
                                <i data-lucide="star" class="w-5 h-5 fill-current"></i>
                                <i data-lucide="star" class="w-5 h-5"></i>
                            </div>
                            <span class="text-white font-semibold">{{ course.rating }}</span>
                            <span class="text-gray-400">({{ course.students_count }} –±–∞“≥–æ)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Course Content -->
                <div class="glass rounded-2xl p-8" data-aos="fade-up">
                    <h2 class="text-2xl font-bold text-white mb-6">–ö—É—Ä—Å —Ç–∞—Ä–∫–∏–±–∏</h2>
                    
                    {% if modules %}
                        <div class="space-y-4">
                            {% for module in modules %}
                            <div class="collapse collapse-arrow glass">
                                <input type="radio" name="course-accordion" {% if forloop.first %}checked{% endif %} />
                                <div class="collapse-title text-xl font-medium text-white">
                                    <div class="flex items-center justify-between">
                                        <span>{{ forloop.counter }}. {{ module.title }}</span>
                                        <span class="badge badge-sm">{{ module.lessons.count }} –¥–∞—Ä—Å</span>
                                    </div>
                                </div>
                                <div class="collapse-content">
                                    <p class="text-gray-400 mb-4">{{ module.description }}</p>
                                    
                                    <div class="space-y-2">
                                        {% for lesson in module.lessons.all %}
                                        <div class="flex items-center justify-between p-3 glass rounded-lg hover:bg-white/10 transition-all">
                                            <div class="flex items-center gap-3">
                                                <!-- Lesson Icon -->
                                                <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center">
                                                    {% if lesson.lesson_type == 'video' %}
                                                        <i data-lucide="play-circle" class="w-4 h-4 text-blue-400"></i>
                                                    {% elif lesson.lesson_type == 'text' %}
                                                        <i data-lucide="file-text" class="w-4 h-4 text-green-400"></i>
                                                    {% elif lesson.lesson_type == 'quiz' %}
                                                        <i data-lucide="help-circle" class="w-4 h-4 text-yellow-400"></i>
                                                    {% else %}
                                                        <i data-lucide="code" class="w-4 h-4 text-purple-400"></i>
                                                    {% endif %}
                                                </div>
                                                
                                                <!-- Lesson Info -->
                                                <div>
                                                    <p class="text-white font-medium">{{ lesson.title }}</p>
                                                    <p class="text-sm text-gray-400">{{ lesson.duration_minutes }} –¥–∞“õ–∏“õ–∞</p>
                                                </div>
                                            </div>
                                            
                                            <!-- Free Badge -->
                                            {% if lesson.is_free %}
                                                <div class="badge badge-sm badge-success">–ë–µ–ø—É–ª</div>
                                            {% elif not is_enrolled %}
                                                <i data-lucide="lock" class="w-4 h-4 text-gray-400"></i>
                                            {% endif %}
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-gray-400 text-center py-8">“≤–æ–∑–∏—Ä—á–∞ –¥–∞—Ä—Å–ª–∞—Ä “õ—û—à–∏–ª–º–∞–≥–∞–Ω</p>
                    {% endif %}
                </div>
                
            </div>
            
            <!-- Sidebar -->
            <div class="space-y-6">
                
                <!-- Enroll Card -->
                <div class="glass rounded-2xl p-6 sticky top-24" data-aos="fade-up">
                    <!-- Course Image -->
                    <div class="w-full h-48 rounded-lg bg-gradient-to-br from-blue-500 to-purple-500 mb-6 overflow-hidden">
                        {% if course.thumbnail %}
                            <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" class="w-full h-full object-cover">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center">
                                <i data-lucide="book-open" class="w-20 h-20 text-white"></i>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Price -->
                    {% if not course.is_free %}
                        <div class="text-center mb-6">
                            <div class="text-4xl font-bold gradient-text">{{ course.price|floatformat:0 }} —Å—û–º</div>
                        </div>
                    {% endif %}
                    
                    <!-- Enroll Button -->
                    {% if is_enrolled %}
                        <a href="{% url 'dashboard' %}" class="btn btn-primary-custom w-full text-white mb-4">
                            <i data-lucide="play-circle" class="w-5 h-5"></i>
                            –î–∞–≤–æ–º —ç—Ç–∏—à
                        </a>
                        <div class="alert alert-success">
                            <i data-lucide="check-circle" class="w-5 h-5"></i>
                            <span>–°–∏–∑ –±—É –∫—É—Ä—Å–≥–∞ —ë–∑–∏–ª–≥–∞–Ω—Å–∏–∑</span>
                        </div>
                        
                        <!-- Progress -->
                        {% if enrollment %}
                        <div class="mt-4">
                            <div class="flex justify-between text-sm text-gray-400 mb-2">
                                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                                <span>{{ enrollment.progress_percentage|floatformat:0 }}%</span>
                            </div>
                            <progress class="progress progress-primary w-full" value="{{ enrollment.progress_percentage }}" max="100"></progress>
                        </div>
                        {% endif %}
                    {% else %}
                        {% if user.is_authenticated %}
                            <form method="POST" action="{% url 'enroll_course' course.slug %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-primary-custom w-full text-white glow">
                                    <i data-lucide="check" class="w-5 h-5"></i>
                                    {% if course.is_free %}–ë–µ–ø—É–ª –±–æ—à–ª–∞—à{% else %}–•–∞—Ä–∏–¥ “õ–∏–ª–∏—à{% endif %}
                                </button>
                            </form>
                        {% else %}
                            <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-primary-custom w-full text-white">
                                <i data-lucide="log-in" class="w-5 h-5"></i>
                                –Å–∑–∏–ª–∏—à —É—á—É–Ω –∫–∏—Ä–∏–Ω–≥
                            </a>
                        {% endif %}
                    {% endif %}
                    
                    <!-- Course Info -->
                    <div class="divider"></div>
                    
                    <div class="space-y-3">
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-400">–î–∞—Ä–∞–∂–∞:</span>
                            <span class="text-white font-semibold">
                                {% if course.level == 'beginner' %}–ë–æ—à–ª–∞–Ω—É–≤—á–∏
                                {% elif course.level == 'intermediate' %}–é—Ä—Ç–∞
                                {% else %}–ò–ª“ì–æ—Ä{% endif %}
                            </span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-400">–î–∞–≤–æ–º–∏–π–ª–∏–∫:</span>
                            <span class="text-white font-semibold">{{ course.duration_hours }} —Å–æ–∞—Ç</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-400">–î–∞—Ä—Å–ª–∞—Ä:</span>
                            <span class="text-white font-semibold">{{ modules|length }} –º–æ–¥—É–ª</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-400">–°—Ç—É–¥–µ–Ω—Ç–ª–∞—Ä:</span>
                            <span class="text-white font-semibold">{{ course.students_count }}</span>
                        </div>
                    </div>
                </div>
                
            </div>
            
        </div>
        
    </div>
</section>

{% endblock %}